name: publish
on:
  workflow_dispatch:

jobs:
  format:
    runs-on: windows-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8

      - name: Prepare workspace
        run: |
          tree
          cd ci-helpers
          ./run_publish.ps1
          cd ../
          tree
          dir texlive\tools
      - name: Check for modified files
        shell: bash
        id: git-check
        run: |
          git status

      - name: Commit and Push
        shell: bash
        if: steps.git-check.outputs.modified == 'true'
        env:
          email_address: ${{ secrets.EMAIL_ADDRESS }}
        run: |
          git config user.name "Naveen M K"
          git config user.email "$env:email_address"
          git add .
          git commit -m "Montly Update for release"
          # git push
      - name: Push to Chocolatey
        env:
          CHOCO_KEY: ${{ secrets.CHOCO_API_KEY }}
        run: |
         cd texlive
         choco pack
         # choco apikey --key $Env:CHOCO_KEY --source https://push.chocolatey.org/
         # choco push --source https://push.chocolatey.org/
      
      
      
